{% extends 'pages/layout.html.twig' %}

{% block title %}Profil de {{ app.user ? app.user.pseudo : 'Utilisateur' }} - le Cavalier Rouge{% endblock %}

{% block meta_description %}
Consultez et gérez votre profil sur Le Cavalier Rouge. Suivez vos compétitions et restez informé des événements d'échecs.
{% endblock %}

{% block og_title %}
Profil de {{ app.user ? app.user.pseudo : 'Utilisateur' }} - Le Cavalier Rouge
{% endblock %}

{% block og_description %}
Retrouvez toutes les informations de {{ app.user ? app.user.pseudo : 'cet utilisateur' }} sur Le Cavalier Rouge. Suivez ses compétitions et évolutions.
{% endblock %}

{% block og_image %}
{{ app.user.avatar ? asset('uploads/avatar/' ~ app.user.avatar) : asset('img/default-avatar.png') }}
{% endblock %}

{% block og_type %}profile{% endblock %}

{% block twitter_title %}
Profil de {{ app.user ? app.user.pseudo : 'Utilisateur' }} - Le Cavalier Rouge
{% endblock %}

{% block twitter_description %}
Découvrez le profil de {{ app.user ? app.user.pseudo : 'cet utilisateur' }} et suivez ses compétitions d'échecs.
{% endblock %}

{% block twitter_image %}
{{ app.user.avatar ? asset('uploads/avatar/' ~ app.user.avatar) : asset('img/default-avatar.png') }}
{% endblock %}

{% block body %}
<div class="profile-container max-w-4xl mx-auto mt-10 p-6 bg-white shadow-lg rounded-lg" data-test="profile-container">
    {% if app.user %}
        <!-- Avatar et modification -->
        <div class="flex items-center justify-center relative">
            <img
                src="{{ app.user.avatar ? asset('uploads/avatar/' ~ app.user.avatar) : asset('images/default-avatar.png') }}"
                alt="Avatar"
                class="avatar-img w-32 h-32 rounded-full border-4 border-gray-300"
                data-test="profile-avatar"
            />
            <a href="{{ path('app_profile_update') }}"
               class="absolute bottom-0 right-0 bg-blue-500 p-2 rounded-full text-white hover:bg-blue-600 focus:outline-none"
               data-test="profile-edit-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 3l9 9-9 9M21 12H7"></path>
                </svg>
            </a>
        </div>

        <!-- Informations utilisateur -->
        <div class="text-center mt-6" data-test="profile-info">
            <h1 class="text-3xl font-semibold text-gray-800" data-test="profile-pseudo">  {{ app.user.pseudo ?: 'Pseudo non renseigné' }}</h1>
            <span class="text-gray-600 mt-2" data-test="profile-lastname">{{ app.user.lastName ?: 'Nom non renseigné' }}</span>
            <span class="text-gray-600 mt-2" data-test="profile-firstname">{{ app.user.firstName ?: 'Prénom non renseigné' }}</span>
            <p class="text-gray-600 mt-2">
                <strong>Email:</strong> <span data-test="profile-email">{{ app.user.email ?: 'Email non renseigné' }}</span>
            </p>
            <p class="text-gray-600 mt-2">
                <strong>Code FFE:</strong> <span data-test="profile-codeFFE">{{ app.user.codeFFE ?: 'Non renseigné' }}</span>
            </p>
            {% if app.user.club %}
                <p class="text-gray-600 mt-2">
                    <strong>Club:</strong> <span data-test="profile-club">{{ app.user.club.name }}</span>
                </p>
            {% else %}
                <p class="text-gray-600 mt-2">
                    <strong>Club:</strong> <span data-test="profile-club">Non renseigné</span>
                </p>
            {% endif %}
        </div>

        <!-- Boutons Feuilles de match et Compétitions -->
        <div class="text-center mt-6" data-test="profile-buttons">
            {% if is_granted('ROLE_CAPITAINE') or is_granted('ROLE_ADMIN') %}
                <div class="flex justify-center gap-4">
                    <a href="{{ path('app_match_sheets') }}" class="bg-purple-500 text-white rounded-lg shadow p-4 hover:bg-purple-600 inline-block" data-test="profile-match-sheets-button">
                        <p class="text-xl font-bold">Feuilles de match</p>
                    </a>
                    <a href="{{ path('user_competitions_list') }}" class="bg-blue-500 text-white rounded-lg shadow p-4 hover:bg-blue-600 inline-block" data-test="profile-competitions-button">
                        <p class="text-xl font-bold">Compétitions</p>
                    </a>
                </div>
            {% else %}
                <a href="{{ path('user_competitions_list') }}" class="bg-blue-500 text-white rounded-lg shadow p-4 hover:bg-blue-600 inline-block" data-test="profile-competitions-button">
                    <p class="text-xl font-bold">Compétitions</p>
                </a>
            {% endif %}
        </div>
    {% else %}
        <p data-test="profile-container-empty">Veuillez vous connecter pour accéder à votre profil.</p>
    {% endif %}
</div>
{% endblock %}
